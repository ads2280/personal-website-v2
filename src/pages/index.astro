---
import { Image } from "astro:assets";
import Layout from "../layouts/Layout.astro";
import { homePageContent, identity } from "../config";
import { getCollection } from "astro:content";

let posts = await getCollection("posts");
posts = posts.filter((p) => !p.data?.draft);
posts.sort((a, b) => {
  const dateA = new Date(a.data.pubDate).getTime();
  const dateB = new Date(b.data.pubDate).getTime();
  return dateB - dateA;
});
posts.splice(3)
---

<Layout seo={homePageContent.seo}>
  <!-- Hero -->
  <section class="px-6 lg:px-16 pt-24 pb-20 max-w-3xl">
    <h1 class="text-4xl lg:text-5xl font-bold tracking-tight mb-6">
      {identity.name}
    </h1>

    <p class="text-lg opacity-60 mb-10 leading-relaxed max-w-xl">
      {homePageContent.description}
    </p>

    <div class="flex items-center gap-6 text-sm">
      {
        homePageContent.socialLinks.map((link) => (
          <a
            href={link.url}
            target="_blank"
            class="opacity-50 hover:opacity-100 transition-opacity"
          >
            {link.title}
          </a>
        ))
      }
    </div>
  </section>

  <!-- Latest posts -->
  <section class="px-6 lg:px-16 pb-24 max-w-4xl">
    <p class="text-xs uppercase tracking-[0.2em] opacity-40 mb-10">Latest</p>

    <div class="space-y-10">
      {
        posts.map((post, index) => (
          <a
            href={`/blog/${post.id.replace(/\.md$/, '')}`}
            class="flex items-start gap-6 group"
          >
            <span class="text-3xl font-bold opacity-20 group-hover:opacity-40 transition-opacity pt-1">
              {String(index + 1).padStart(2, '0')}
            </span>
            <div class="flex-1">
              <p class="text-xs opacity-40 mb-2">
                {post.data.pubDate.toLocaleDateString()}
              </p>
              <h3 class="text-lg font-medium opacity-80 group-hover:opacity-100 transition-opacity mb-2">
                {post.data.title}
              </h3>
              <p class="text-sm opacity-50">{post.data.description}</p>
            </div>
            <Image
              src={post.data.image.url}
              alt={post.data.image.alt}
              width={100}
              height={100}
              class="hidden sm:block w-24 h-24 object-cover rounded opacity-60 group-hover:opacity-100 transition-opacity"
            />
          </a>
        ))
      }
    </div>

    <a href="/blog" class="inline-block mt-12 text-sm opacity-40 hover:opacity-100 transition-opacity">
      All posts â†’
    </a>
  </section>
</Layout>
