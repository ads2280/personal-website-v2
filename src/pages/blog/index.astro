---
import { Image } from "astro:assets";
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";
import { blogPageContent } from "../../config";
import { render } from "astro:content";

let posts = await getCollection("posts");
posts = posts.filter((p) => !p.data?.draft);
posts.sort((a, b) => {
  const dateA = new Date(a.data.pubDate).getTime();
  const dateB = new Date(b.data.pubDate).getTime();
  return dateB - dateA;
});
for (const post of posts) {
  const { remarkPluginFrontmatter } = await render(post);
  post.data.readingTime = remarkPluginFrontmatter.minutesRead;
}
---

<Layout seo={blogPageContent.seo}>
  <div class="relative min-h-screen">
    <!-- Vertical text on left -->
    <div class="hidden lg:flex items-center justify-center w-16 fixed left-4 top-1/2 -translate-y-1/2">
      <p class="vertical-text text-xs tracking-[0.3em] uppercase opacity-40">
        Writing · Ideas
      </p>
    </div>

    <section class="px-6 lg:px-16 pt-16 lg:pt-24 max-w-4xl">
      <!-- Header -->
      <div class="mb-16">
        <span class="bracket-label opacity-60 mb-4 block">[Archive]</span>
        <h1 class="text-4xl lg:text-5xl font-bold tracking-tight mb-4">Blog</h1>
        <p class="opacity-60 max-w-md">{blogPageContent.subtitle}</p>
      </div>

      <!-- Posts grid -->
      <div class="space-y-12">
        {
          posts.map((post, index) => (
            <a
              href={`/blog/${post.id.replace(/\.md$/, '')}`}
              class="flex items-start gap-6 group"
            >
              <span class="text-4xl lg:text-5xl font-bold opacity-20 group-hover:opacity-60 transition-opacity shrink-0">
                [{String(index + 1).padStart(2, '0')}]
              </span>
              <div class="flex-1 min-w-0">
                <p class="text-xs uppercase tracking-wider opacity-40 mb-2">
                  {post.data.pubDate.toLocaleDateString()} · {post.data.readingTime}
                </p>
                <h2 class="text-xl lg:text-2xl font-medium opacity-90 group-hover:opacity-100 transition-opacity mb-2">
                  {post.data.title}
                </h2>
                <p class="text-sm opacity-50 line-clamp-2">{post.data.description}</p>
              </div>
              <Image
                src={post.data.image.url}
                alt={post.data.image.alt}
                width={120}
                height={120}
                class="hidden sm:block rounded w-28 h-28 object-cover opacity-60 group-hover:opacity-100 transition-opacity shrink-0"
              />
            </a>
          ))
        }
      </div>
    </section>
  </div>
</Layout>
